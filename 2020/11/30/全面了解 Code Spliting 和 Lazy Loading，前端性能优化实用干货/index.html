
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>全面了解 Code Spliting 和 Lazy Loading，前端性能优化实用干货 - Axton&#39;s Blog</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Axton,Axton-Tang,前端博客,"> 
    <meta name="description" content="全面了解 Code Spliting 和 Lazy Loading，前端性能优化实用干货一、什么是 Code Spliting 和 Lazy Loading ？简单的来讲，就是我们将代码进行 Cod,"> 
    <meta name="author" content="Axton Tang"> 
    <link rel="alternative" href="atom.xml" title="Axton&#39;s Blog" type="application/atom+xml"> 
    <link rel="icon" href="/img/axton-avatar.jpg"> 
    <link href="https://fonts.loli.net/css?family=Roboto+Mono|Rubik&display=swap" rel="stylesheet">
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.7.2/animate.min.css">

    
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/codemirror.min.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/theme/dracula.css">

    
<link rel="stylesheet" href="/css/obsidian.css">

    
<link rel="stylesheet" href="/css/ball-atom.min.css">

    
<link rel="stylesheet" href="/css/iconfont.css">

<meta name="generator" content="Hexo 5.1.1"></head>


<body class="loading">
    <div class="loader">
        <div class="la-ball-atom la-2x">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <span id="config-title" style="display:none">Axton&#39;s Blog</span>
    <div id="loader"></div>
    <div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" class="icon-home" src="/img/axton-avatar.jpg" alt="" data-url="https://www.axton-tang.top">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">全面了解 Code Spliting 和 Lazy Loading，前端性能优化实用干货</h3>
        <div class="social">
            <!--        <div class="like-icon">-->
            <!--            <a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
            <!--        </div>-->
            <div>
                <div class="share">
                    
                        <a href="javascript:;" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        
<div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
            animation-delay: 600ms;
            animation-duration: 1.2s;
            background-image: 
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(/img/cover.jpg) ">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                <a href="/categories/性能优化"><b>「
                    </b>性能优化<b> 」</b></a>
                
                十一月 30, 2020
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/2020/11/30/%E5%85%A8%E9%9D%A2%E4%BA%86%E8%A7%A3%20Code%20Spliting%20%E5%92%8C%20Lazy%20Loading%EF%BC%8C%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E7%94%A8%E5%B9%B2%E8%B4%A7/" title="全面了解 Code Spliting 和 Lazy Loading，前端性能优化实用干货" class="">全面了解 Code Spliting 和 Lazy Loading，前端性能优化实用干货</a>
            </h3>
            
            <p class="post-count animated fadeInDown">
                
                <span>
                    <b class="iconfont icon-text2"></b> <i>文章字数</i>
                    15k
                </span>
                
                
                <span>
                    <b class="iconfont icon-timer__s"></b> <i>阅读约需</i>
                    14 mins.
                </span>
                
                
                <span id="/2020/11/30/全面了解 Code Spliting 和 Lazy Loading，前端性能优化实用干货/" class="leancloud_visitors" data-flag-title="全面了解 Code Spliting 和 Lazy Loading，前端性能优化实用干货">
                    <b class="iconfont icon-read"></b> <i>阅读次数</i>
                    <span class="leancloud-visitors-count">1000000</span>
                </span>
                
                
            </p>
            
            
            <ul class="animated fadeInDown post-tags-list" itemprop="keywords"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" rel="tag">性能优化</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s"></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <h1 id="全面了解-Code-Spliting-和-Lazy-Loading，前端性能优化实用干货"><a href="#全面了解-Code-Spliting-和-Lazy-Loading，前端性能优化实用干货" class="headerlink" title="全面了解 Code Spliting 和 Lazy Loading，前端性能优化实用干货"></a>全面了解 Code Spliting 和 Lazy Loading，前端性能优化实用干货</h1><h2 id="一、什么是-Code-Spliting-和-Lazy-Loading-？"><a href="#一、什么是-Code-Spliting-和-Lazy-Loading-？" class="headerlink" title="一、什么是 Code Spliting 和 Lazy Loading ？"></a>一、什么是 Code Spliting 和 Lazy Loading ？</h2><p>简单的来讲，就是我们将代码进行 <code>Code Spliting</code> （代码分离），分离成很多块（<code>chunk</code>） ，然后可以按需要加载不同的代码，也就是 <code>Lazy Loading</code> （懒加载）。这样的话，可以极大的减少我们的初始化时的请求次数，而且还可以命中浏览器的缓存，避免多次请求相同代码，来提升网页加载的速度。</p>
<h2 id="二、了解-import-函数"><a href="#二、了解-import-函数" class="headerlink" title="二、了解 import() 函数"></a>二、了解 import() 函数</h2><p>在正式进入学习代码分离和懒加载之前，我们需要提前了解 <code>import()</code>函数，因为之后很多地方都要用到它。</p>
<p>它是 ES2020 提案的内容，目前处于<a target="_blank" rel="noopener" href="https://tc39.github.io/process-document/">TC39流程的</a>第 4 阶段。它类似于 <code>commonJS</code> 中的 <code>require</code>， 能够动态加载模块。</p>
<p><strong>基础使用</strong></p>
<p><code>import()</code>返回一个 <code>Promise</code> 对象，可以使用 <code>.then()</code> 获取返回的对象，当做它的参数，该参数可以使用解构赋值的语法获取。</p>
<pre><code class="js">document.addEventListener(&#39;click&#39;, () =&gt; &#123;
  import(&#39;lodash&#39;).then((&#123;default: _ &#125;) =&gt; &#123;
    console.log(_.join([&#39;Axton&#39;, &#39;Tang&#39;], &#39; &#39;))
  &#125;)
&#125;)</code></pre>
<p><strong>注意：</strong>浏览器不支持直接使用 <code>import()</code> 函数，可以在 <code>webpack</code> 中使用 <code>@babel/polyfill</code> 进行语法转换。</p>
<p><em>好了，到这里大家对 <code>import()</code> 应该有个大概了解了，下面开始进入正题。</em></p>
<h2 id="三、Webpack-中的配置与实现"><a href="#三、Webpack-中的配置与实现" class="headerlink" title="三、Webpack 中的配置与实现"></a>三、Webpack 中的配置与实现</h2><h3 id="1、-JS-代码分离的三种方式"><a href="#1、-JS-代码分离的三种方式" class="headerlink" title="1、 JS 代码分离的三种方式"></a>1、 JS 代码分离的三种方式</h3><p>很多时候我们会使用到像 <code>lodash</code> 这样的第三方库，如果将它打包到我们的主代码中，会使打包后文件过大。为了解决此问题，下面开始介绍不同的配置方式。</p>
<h4 id="（1）手动实现代码分离"><a href="#（1）手动实现代码分离" class="headerlink" title="（1）手动实现代码分离"></a>（1）手动实现代码分离</h4><p>主文件为 <code>index.js</code>， 在 <code>lodash.js</code> 文件中导入 <code>lodash</code> 库，在 <code>webpack</code> 配置文件中配置多个入口。</p>
<pre><code class="js">// index.js
console.log(_.join([&#39;Axton&#39;, &#39;Tang&#39;], &#39;-&#39;)) 

// lodash.js
import _ from &#39;lodash&#39;
window._ = _        // 将 &#39;_&#39; 绑定到全局使用

// webpack.config.js
module.exports = &#123;
  entry: &#123;
    lodash: &#39;./src/lodash.js&#39;,
    main: &#39;./src/index.js&#39;
  &#125;
  //...
&#125;</code></pre>
<p>此种方法存在的问题是，如果多个模块之间存在公共的一些部分，将会重复引用到 <code>bundle</code> 中。所以，不推荐使用。</p>
<h4 id="（2）使用-SplitChunksPlugin-插件"><a href="#（2）使用-SplitChunksPlugin-插件" class="headerlink" title="（2）使用 SplitChunksPlugin 插件"></a>（2）使用 SplitChunksPlugin 插件</h4><h5 id="快速使用"><a href="#快速使用" class="headerlink" title="快速使用"></a>快速使用</h5><p>在配置文件中添加以下代码即可分离同步及异步代码。</p>
<pre><code class="js">// webpack.config.js

module.exports = &#123;
  // ...
  optimization: &#123;
    splitChunks: &#123;
      chunks: &#39;all&#39;
    &#125;
  &#125;
 // ...
&#125;</code></pre>
<p>这样将会新生成一个以 <code>vendor</code>开头的 <code>chunk</code>， 能够自动实现主代码和导入的第三方库的分离，而且还能去除掉重复依赖的模块。</p>
<h5 id="了解配置"><a href="#了解配置" class="headerlink" title="了解配置"></a>了解配置</h5><p>在进行上面简单的配置后，很快就能够实现自动分离。但是， <code>webpack</code> 在背后帮我们添加了很多默认的配置项。</p>
<pre><code class="js">module.exports = &#123;
  //...
  optimization: &#123;
    splitChunks: &#123;
      chunks: &#39;async&#39;,    //三选一：&quot;initial&quot; 初始化，&quot;all&quot;(同步异步都有效)，&quot;async&quot;（只对异步有效）
      minSize: 20000,    // 形成一个新代码块最小的体积,只有 &gt;= minSize 的bundle会被拆分出来
      minRemainingSize: 0,    // 确保拆分后剩余的最小块大小超过此设置，来避免大小为零的模块
      maxSize: 0,    //拆分之前最大的数值，默认为0，即不做限制
      minChunks: 1,        //引入次数，如果为2 那么一个资源最少被引用两次才可以被拆分出来
      maxAsyncRequests: 30,        // 按需加载的最大并行请求数
      maxInitialRequests: 30,    // 一个入口最大并行请求数
      automaticNameDelimiter: &#39;~&#39;,    // 文件名的连接符
      enforceSizeThreshold: 50000,    //强制执行拆分的大小阈值
      cacheGroups: &#123;    // 缓存组可以继承或覆盖以上任何选项
        defaultVendors: &#123;
          test: /[\\/]node_modules[\\/]/,    // 正则表达式验证，如果符合就提取 chunk
          priority: -10,    // 缓存组优先级,即权重
          reuseExistingChunk: true    // 可设置是否重用已用chunk,不再创建新的chunk
        &#125;,
        default: &#123;
          minChunks: 2,
          priority: -20,
          reuseExistingChunk: true
        &#125;
      &#125;
    &#125;
  &#125;
&#125;;</code></pre>
<p>大部分时候使用其默认配置就可以了，如果有更高的要求需要配置，可以参考 <a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/split-chunks-plugin/">此文档</a></p>
<h4 id="（3）使用-import-函数动态导入"><a href="#（3）使用-import-函数动态导入" class="headerlink" title="（3）使用 import() 函数动态导入"></a>（3）使用 import() 函数动态导入</h4><p>对于使用 <code>import()</code> 的异步代码，我们并不需要进行 <code>optimization.splitChunks</code> 的配置，打包后会自动分离到一个新的 <code>chunk</code> 中。</p>
<pre><code class="js">import(&#39;lodash&#39;).then((&#123;default: _ &#125;) =&gt; &#123;
    console.log(_.join([&#39;Axton&#39;, &#39;Tang&#39;], &#39; &#39;))
&#125;)</code></pre>
<h3 id="2、懒加载与缓存"><a href="#2、懒加载与缓存" class="headerlink" title="2、懒加载与缓存"></a>2、懒加载与缓存</h3><h4 id="（1）简单使用"><a href="#（1）简单使用" class="headerlink" title="（1）简单使用"></a>（1）简单使用</h4><p>既然能够使用 <code>import()</code> 动态导入，那么在外层加上一些触发的条件，那就是懒加载了。</p>
<pre><code class="js">btn.addEventListener(&#39;click&#39;, () =&gt; &#123;
  import(&#39;lodash&#39;).then((&#123;default: _ &#125;) =&gt; &#123;
    console.log(_.join([&#39;Axton&#39;, &#39;Tang&#39;], &#39; &#39;))
  &#125;)
&#125;)</code></pre>
<p>当我们点击按钮后，才会请求这个新的 <code>chunk</code></p>
<p><img src="https://upyun.axton-tang.top/webapck_code_spliting/lazy_loading_one.gif"></p>
<h4 id="（2）同步与异步差异"><a href="#（2）同步与异步差异" class="headerlink" title="（2）同步与异步差异"></a>（2）同步与异步差异</h4><p><strong><em>同步代码</em></strong></p>
<p>如果我们使用的是同步的代码，在文件的顶部使用 <code>import ... from &#39;...&#39;</code>的语法导入第三方库，在使用 <code>SplitChunksPlugin</code> 配置后确实是可以实现代码分离。但是这样的分离后，在浏览器请求时会是同时请求，唯一提升性能的一点就是会命中浏览器的缓存。见下图：</p>
<p><img src="https://upyun.axton-tang.top/webapck_code_spliting/lazy_loading_two.gif"></p>
<p><strong><em>异步代码</em></strong></p>
<p>对于使用 <code>import()</code> 函数的异步代码，只有当我们使用时才会发出请求。有时，我们可能永远都不会用到，那么能极大的提高性能。在之前配置 <code>splitChunks.chunks</code>时，默认的值为 <code>async</code> ，那是因为官方并不推荐我们使用同步代码进行如此的分离。因为同步代码仍然是同时请求，使用缓存也只对之后再次访问才有效，对性能的提升是很低的。</p>
<p><strong>所以，之后我们引入第三方库的时候都要尽量使用异步的方式。</strong></p>
<h3 id="3、Preloading-和-Prefetching"><a href="#3、Preloading-和-Prefetching" class="headerlink" title="3、Preloading 和 Prefetching"></a>3、Preloading 和 Prefetching</h3><p>讲到这里，可能大家会有疑问，对于一些我们暂时使用不到的 <code>chunk</code>初始时都不进行加载，在用到时再加载，那这样会不会导致之后执行某些操作会加载很慢呢？</p>
<p>确实可能会这样，因此我们现在来讲预加载。</p>
<ul>
<li><strong>prefetch</strong>(预获取)：加载将来某些导航下可能需要的资源</li>
<li><strong>preload</strong>(预加载)：加载当前导航下可能需要资源, 会与主<code>chunk </code>同步加载，不推荐使用。</li>
</ul>
<p>使用 <code>prefetch</code>会在我们主要代码加载完毕后，浏览器空闲的时间里，提前加载代码，使用方式是在 <code>import()</code> 中添加一段 “魔法注释”。</p>
<pre><code class="js">btn.addEventListener(&#39;click&#39;, () =&gt; &#123;
  import(/* webpackPrefetch: true */ &#39;lodash&#39;).then((&#123;default: _ &#125;) =&gt; &#123;
    console.log(_.join([&#39;Axton&#39;, &#39;Tang&#39;], &#39; &#39;))
  &#125;)
&#125;)</code></pre>
<h3 id="4、对-CSS-代码进行分离"><a href="#4、对-CSS-代码进行分离" class="headerlink" title="4、对 CSS 代码进行分离"></a>4、对 CSS 代码进行分离</h3><p>首先安装 <code>mini-css-extract-plugin</code>：</p>
<pre><code class="bash">npm install --save-dev mini-css-extract-plugin</code></pre>
<p>之后进行如下配置即可生成一个 <code>css</code> 文件的 <code>chunk</code></p>
<p><strong>style.css</strong></p>
<pre><code class="css">body &#123;
  background: blue;
&#125;</code></pre>
<p><strong>component.js</strong></p>
<pre><code class="js">import &#39;./style.css&#39;;</code></pre>
<p><strong>webpack.config.js</strong></p>
<pre><code class="js">const MiniCssExtractPlugin = require(&#39;mini-css-extract-plugin&#39;);

module.exports = &#123;
  plugins: [new MiniCssExtractPlugin(&#123;
      filename: &#39;[name].css&#39;,    // 打包后入口文件的名字
      chunkFilename: &#39;[name].chunk.css&#39;        // 打包后非入口文件的名字
  &#125;)],
  module: &#123;
    rules: [
      &#123;
        test: /\.css$/i,
        use: [MiniCssExtractPlugin.loader, &#39;css-loader&#39;],
      &#125;,
    ],
  &#125;,
&#125;;</code></pre>
<h2 id="四、Vue-中的配置与应用"><a href="#四、Vue-中的配置与应用" class="headerlink" title="四、Vue 中的配置与应用"></a>四、Vue 中的配置与应用</h2><h3 id="1、异步组件"><a href="#1、异步组件" class="headerlink" title="1、异步组件"></a>1、异步组件</h3><p>异步组件为动态导入的组件，仅当使用到它时才加载。</p>
<h4 id="（1）在Vue-3-中的新用法"><a href="#（1）在Vue-3-中的新用法" class="headerlink" title="（1）在Vue 3 中的新用法"></a>（1）在Vue 3 中的新用法</h4><p>对于 <code>Vue3</code> 中的一些语法新特性，大家可以看一下我的<a target="_blank" rel="noopener" href="https://juejin.cn/post/6885181371749236749">这篇博客</a>。</p>
<p>在 <code>vue3</code>  中新增了一个方法：<code>defineAsyncComponent</code>，用来显式地定义异步组件</p>
<pre><code class="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;button @click=&quot;handleClick&quot;&gt;按钮&lt;/button&gt;  &lt;!-- 按需要来控制组件的显示 --&gt;
    &lt;AsyncComponent v-if=&quot;show&quot; /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import &#123; defineAsyncComponent, ref &#125; from &quot;vue&quot;;

export default &#123;
  name: &#39;Home&#39;,
  components: &#123;
    AsyncComponent: defineAsyncComponent(() =&gt;
      import(&quot;../../components/AsyncComponent&quot;) // 动态导入组件
    ),
  &#125;,
  setup() &#123;
    let show = ref(false)
    const handleClick = () =&gt; &#123;
      show.value = true
    &#125;
    return &#123;
      show,
      handleClick
    &#125;
  &#125;
&#125;;
&lt;/script&gt;</code></pre>
<p>上面代码中我们使用 <code>show</code> 变量来控制这个异步组件的显示。然而，在下图中我们查看请求时发现 <code>0.js</code> 已经提前加载完毕了。其实，这就是我们之前 <code>webpack</code> 的配置时所说的 <code>prefetch</code>，在浏览器空闲时提前加载了之后所需要的资源。</p>
<p><img src="https://upyun.axton-tang.top/webapck_code_spliting/asyncComponent.gif"></p>
<h4 id="（2）在-Vue-2-x-中的用法"><a href="#（2）在-Vue-2-x-中的用法" class="headerlink" title="（2）在 Vue 2.x 中的用法"></a>（2）在 Vue 2.x 中的用法</h4><pre><code class="js">export default &#123;
  name: &#39;Home&#39;,
  components: &#123;
    AsyncComponent: () =&gt; import(&quot;../../components/AsyncComponent&quot;) // 动态导入组件
  &#125;,
&#125;;</code></pre>
<h3 id="2、路由的懒加载"><a href="#2、路由的懒加载" class="headerlink" title="2、路由的懒加载"></a>2、路由的懒加载</h3><p>对于暂未跳转到的路由不进行相关资源加载，用到时再加载。但是在实际应用中，还是会像上面的异步组件一样，在浏览器空闲时进行 <code>prefetch</code>。</p>
<pre><code class="js">import &#123; createRouter, createWebHistory &#125; from &#39;vue-router&#39;

import Home from &#39;../pages/Home/Home.vue&#39;

const routerHistory = createWebHistory()

export default createRouter(&#123;
  history: routerHistory,
  routes: [&#123;
    path: &#39;/&#39;,
    component: Home
  &#125;, &#123;
    path: &#39;/demo&#39;,
    component: () =&gt; import(&#39;../pages/Demo/Demo.vue&#39;)        // 路由懒加载
  &#125;]
&#125;)</code></pre>
<h2 id="五、React-中的配置与应用"><a href="#五、React-中的配置与应用" class="headerlink" title="五、React 中的配置与应用"></a>五、React 中的配置与应用</h2><h3 id="1、异步组件-1"><a href="#1、异步组件-1" class="headerlink" title="1、异步组件"></a>1、异步组件</h3><h4 id="（1）使用-React-lazy-和-Suspense"><a href="#（1）使用-React-lazy-和-Suspense" class="headerlink" title="（1）使用 React.lazy 和 Suspense"></a>（1）使用 React.lazy 和 Suspense</h4><p><code>React.lazy</code> 接受一个函数，这个函数需要动态调用 <code>import()</code>。<code>React.lazy</code> 加载的组件只能在 <code>&lt;Suspense&gt;</code> 组件下使用，代码如下：</p>
<pre><code class="react">import React, &#123; Suspense, Component &#125; from &#39;react&#39;

const LazyComponent = React.lazy(() =&gt; import(&#39;./components/LazyComponent&#39;));

class Home extends Component &#123;
  constructor(props) &#123;
    super(props);
    this.state = &#123;
      show: false
    &#125;;
    this.handleClick = this.handleClick.bind(this);
  &#125;
  render() &#123;
    return (
      &lt;div&gt;
        &lt;button onClick=&#123;this.handleClick&#125;&gt;按钮&lt;/button&gt;
        &#123;
          this.state.show &amp;&amp;
          (&lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;/div&gt;&#125;&gt;
            &lt;LazyComponent /&gt;
          &lt;/Suspense&gt;)
        &#125;
      &lt;/div&gt;
    )
  &#125;
  handleClick() &#123;
    this.setState(&#123;
      show: true
    &#125;)
  &#125;
&#125;

export default Home;</code></pre>
<p>结果如下图所示，我们可以看到点击按钮后 <code>2.chunk.js</code> 才加载出来，页面上先会显示 ‘Loding…’， 然后再显示异步组件的内容。</p>
<p><img src="https://upyun.axton-tang.top/webapck_code_spliting/asyncComponent_two.gif"></p>
<h4 id="（2）使用-loadable-components"><a href="#（2）使用-loadable-components" class="headerlink" title="（2）使用 @loadable/components"></a>（2）使用 @loadable/components</h4><p>示例：</p>
<pre><code class="react">import React, &#123; Component &#125; from &#39;react&#39;
import loadable from &#39;@loadable/component&#39;

const LazyComponent = loadable(() =&gt; import(&#39;./components/LazyComponent&#39;))

class Home extends Component &#123;
  constructor(props) &#123;
    super(props);
    this.state = &#123;
      show: false
    &#125;;
    this.handleClick = this.handleClick.bind(this);
  &#125;
  render() &#123;
    return (
      &lt;div&gt;
        &lt;button onClick=&#123;this.handleClick&#125;&gt;按钮&lt;/button&gt;
        &#123;
          this.state.show &amp;&amp; &lt;LazyComponent /&gt;
        &#125;
      &lt;/div&gt;
    )
  &#125;
  handleClick() &#123;
    this.setState(&#123;
      show: true
    &#125;)
  &#125;
&#125;

export default Home;</code></pre>
<p>这里举例的只是组件的异步加载，该插件还能使用 <code>Suspense</code> 、 <code>Prefetching</code>等等，如果你想深入了解，可以参考<a target="_blank" rel="noopener" href="https://loadable-components.com/">官方文档</a>。</p>
<blockquote>
<p>**使用 React.lazy 和 @loadable/components 的区别： **</p>
<ul>
<li><code>React.lazy</code> 是由 <code>React</code> 官方维护，推荐的代码拆分的解决方案。</li>
<li><code>React.lazy</code>只能与 <code>Suspense</code> 一起使用，而且不支持服务端渲染。<code>@loadable/component</code>支持服务端渲染。</li>
</ul>
</blockquote>
<p>说明：<code>react-loadable</code> 也可以进行 <code>React</code> 的代码拆分，但是由于它已经没有被维护，并且与Webpack v4 +和Babel v7 +不兼容，所以，还是推荐使用以上两种解决方案。</p>
<h3 id="2、路由的懒加载-1"><a href="#2、路由的懒加载-1" class="headerlink" title="2、路由的懒加载"></a>2、路由的懒加载</h3><pre><code class="react">import React, &#123; Suspense, lazy &#125; from &#39;react&#39;;
import &#123; BrowserRouter as Router, Route, Switch &#125; from &#39;react-router-dom&#39;;

const Home = lazy(() =&gt; import(&#39;./pages/home/index&#39;));
const List = lazy(() =&gt; import(&#39;./pages/List/index&#39;));

function App() &#123;
  return (
    &lt;div className=&quot;App&quot;&gt;
     &lt;Router&gt;
        &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;/div&gt;&#125;&gt;
          &lt;Switch&gt;
            &lt;Route exact path=&quot;/&quot; component=&#123;Home&#125;/&gt;
            &lt;Route path=&quot;/list&quot; component=&#123;List&#125;/&gt;
          &lt;/Switch&gt;
        &lt;/Suspense&gt;
      &lt;/Router&gt;
    &lt;/div&gt;
  );
&#125;

export default App;</code></pre>
<h2 id="六、写在文末"><a href="#六、写在文末" class="headerlink" title="六、写在文末"></a>六、写在文末</h2><p>感谢你能够看到这里，最后记得给我个赞哦！很多东西都是我边学边做边记录的，可能会有些错误或不足的地方，欢迎大家在评论区指出来哈！</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
            <ul id="audio-list" style="display:none">
                
                
                <li title='0' data-url='/statics/wuwen.m4a'></li>
                
                    
            </ul>
            
            
            
            <div id="vcomments"></div>
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="https://upyun.axton-tang.top/axton-avatar.jpg" height=300 width=300></img>
                    <p>Axton Tang</p>
                    <span>I hope what you strive for will be as you wish in the end!</span>
                    <dl>
                        <dd><a href="https://github.com/Axton-Tang" target="_blank"><span class=" iconfont icon-github"></span></a></dd>
                        <dd><a href="https://www.zhihu.com/people/chen-zao-38-10" target="_blank"><span
                                    class=" iconfont icon-zhihu"></span></a></dd>
                        <dd><a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=873948360&website=www.oicqzone.com" target="_blank"><span
                                    class=" iconfont icon-qq"></span></a></dd>
                    </dl>
                </div>
                <ul>
                    <li><a href="/">5 <p>文章</p></a></li>
                    <li><a href="/categories">5 <p>分类</p></a></li>
                    <li><a href="/tags">5 <p>标签</p></a></li>
                </ul>
            </div>
            
            
            
            <div class="box sticky animated fadeInRight faster">
                <div id="toc" class="subbox">
                    <h4>目录</h4>
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A8%E9%9D%A2%E4%BA%86%E8%A7%A3-Code-Spliting-%E5%92%8C-Lazy-Loading%EF%BC%8C%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E7%94%A8%E5%B9%B2%E8%B4%A7"><span class="toc-number">1.</span> <span class="toc-text">全面了解 Code Spliting 和 Lazy Loading，前端性能优化实用干货</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF-Code-Spliting-%E5%92%8C-Lazy-Loading-%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">一、什么是 Code Spliting 和 Lazy Loading ？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%BA%86%E8%A7%A3-import-%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.</span> <span class="toc-text">二、了解 import() 函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Webpack-%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.</span> <span class="toc-text">三、Webpack 中的配置与实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81-JS-%E4%BB%A3%E7%A0%81%E5%88%86%E7%A6%BB%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.1.</span> <span class="toc-text">1、 JS 代码分离的三种方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%87%92%E5%8A%A0%E8%BD%BD%E4%B8%8E%E7%BC%93%E5%AD%98"><span class="toc-number">1.3.2.</span> <span class="toc-text">2、懒加载与缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81Preloading-%E5%92%8C-Prefetching"><span class="toc-number">1.3.3.</span> <span class="toc-text">3、Preloading 和 Prefetching</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%AF%B9-CSS-%E4%BB%A3%E7%A0%81%E8%BF%9B%E8%A1%8C%E5%88%86%E7%A6%BB"><span class="toc-number">1.3.4.</span> <span class="toc-text">4、对 CSS 代码进行分离</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Vue-%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%BA%94%E7%94%A8"><span class="toc-number">1.4.</span> <span class="toc-text">四、Vue 中的配置与应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">1、异步组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%B7%AF%E7%94%B1%E7%9A%84%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.4.2.</span> <span class="toc-text">2、路由的懒加载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81React-%E4%B8%AD%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%BA%94%E7%94%A8"><span class="toc-number">1.5.</span> <span class="toc-text">五、React 中的配置与应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6-1"><span class="toc-number">1.5.1.</span> <span class="toc-text">1、异步组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%B7%AF%E7%94%B1%E7%9A%84%E6%87%92%E5%8A%A0%E8%BD%BD-1"><span class="toc-number">1.5.2.</span> <span class="toc-text">2、路由的懒加载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%86%99%E5%9C%A8%E6%96%87%E6%9C%AB"><span class="toc-number">1.6.</span> <span class="toc-text">六、写在文末</span></a></li></ol></li></ol>
                </div>
            </div>
            
            
        </div>
    </div>
</div>

    </div>
</div>
    <div id="back-to-top" class="animated fadeIn faster">
        <div class="flow"></div>
        <span class="percentage animated fadeIn faster">0%</span>
        <span class="iconfont icon-top02 animated fadeIn faster"></span>
    </div>
</body>
<footer>
    <p class="copyright" id="copyright">
        &copy; 2020
        <span class="gradient-text">
            Axton Tang
        </span>.
        Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
        Theme
        <span class="gradient-text">
            <a href="https://github.com/TriDiamond/hexo-theme-obsidian" title="Obsidian" target="_blank" rel="noopener">Obsidian</a>
        </span>
        <small><a href="https://github.com/TriDiamond/hexo-theme-obsidian/blob/master/CHANGELOG.md" title="v1.4.4" target="_blank" rel="noopener">v1.4.4</a></small>
        <br><a target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn">湘ICP备20009728号</a>
</p>

</footer>

<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script>
  MathJax.Hub.Config({
    "HTML-CSS": {
      preferredFont: "TeX",
      availableFonts: ["STIX", "TeX"],
      linebreaks: {
        automatic: true
      },
      EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
      inlineMath: [
        ["$", "$"],
        ["\\(", "\\)"]
      ],
      processEscapes: true,
      ignoreClass: "tex2jax_ignore|dno",
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      noUndefined: {
        attributes: {
          mathcolor: "red",
          mathbackground: "#FFEEEE",
          mathsize: "90%"
        }
      },
      Macros: {
        href: "{}"
      }
    },
    messageStyle: "none"
  });
</script>
<script>
  function initialMathJax() {
    MathJax.Hub.Queue(function () {
      var all = MathJax.Hub.getAllJax(),
        i;
      // console.log(all);
      for (i = 0; i < all.length; i += 1) {
        console.log(all[i].SourceElement().parentNode)
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  }

  function reprocessMathJax() {
    if (typeof MathJax !== 'undefined') {
      MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
    }
  }
</script>


 
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/obsidian.js"></script>
<script src="/js/jquery.truncate.js"></script>
<script src="/js/search.js"></script>
 
<script src="//cdn.bootcss.com/typed.js/2.0.10/typed.min.js"></script>
 
<script src="//cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script>
 
<script src="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>


<script src="https://cdn.bootcss.com/codemirror/5.48.4/codemirror.min.js"></script>
 
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/javascript/javascript.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/css/css.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/xml/xml.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/htmlmixed/htmlmixed.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/clike/clike.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/php/php.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/shell/shell.min.js"></script>
  
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/python/python.min.js"></script>
   
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css">


<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="//www.googletagmanager.com/gtag/js?id=UA-149874671-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'UA-149874671-1');
</script>
 

<script>
  function initialTyped() {
    var typedTextEl = $('.typed-text');
    if (typedTextEl && typedTextEl.length > 0) {
      var typed = new Typed('.typed-text', {
        strings: ['I hope what you strive for will be as you wish in the end!', '希望你所拼命争取的，最后都能如你所愿！'],
        typeSpeed: 90,
        loop: true,
        loopCount: Infinity,
        backSpeed: 20,
      });
    }
  }

  if ($('.article-header') && $('.article-header').length) {
    $(document).ready(function () {
      initialTyped();
    });
  }
</script>

 
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var valine = new Valine();

  function initValine(path) {
    if (!path) path = window.location.pathname;
    let language = 'zh-CN';
    if (!language) {
      language = 'en';
    } else {
      language = language.toLowerCase();
    }
    valine.init({
      el: '#vcomments',
      appId: 'QHCOIEBlyjBUMAjaE5ilzafk-gzGzoHsz',
      appKey: 'ggeGwz8ypB9uiAIYSRH5T0PF',
      notify: 'false',
      verify: 'false',
      avatar: 'mp',
      placeholder: 'Leave your throughs behind~',
      visitor: 'true',
      path: path,
      lang: language,
    });
  }

  $(document).ready(function () {
    initValine();
  });
</script>


</html>
